import React, { createContext, useContext, useCallback, useState, useEffect, useMemo } from "react";
import { supabase } from "./supabase";

type TranslateFunction = (key: string, vars?: Record<string, string>) => string;

type I18nContextValue = {
  lang: string;
  setLang: (code: string) => void;
  t: TranslateFunction;
};

const I18nContext = createContext<I18nContextValue>({
  lang: "en",
  setLang: () => {},
  t: (key) => key,
});

type Dict = Record<string, string>;

const en: Dict = {
  "nav.home": "Home",
  "nav.health": "Health",
  "nav.documents": "Documents",
  "nav.translate": "Translate",
  "nav.record": "Record",

  "common.save": "Save",
  "common.saved": "Saved",
  "common.cancel": "Cancel",
  "common.back": "Back",
  "common.next": "Next",
  "common.loading": "Loading...",
  "common.saving": "Saving...",
  "common.processing": "Processing...",
  "common.signOut": "Sign Out",
  "common.error": "Error",
  "common.getStarted": "Get Started",
  "common.newChat": "New Chat",
  "common.you": "You",

  "home.greeting.morning": "Good morning",
  "home.greeting.afternoon": "Good afternoon",
  "home.greeting.evening": "Good evening",
  "home.subtitle": "Your health assistant is here to help",
  "home.upcoming": "upcoming",
  "home.appointment": "appointment",
  "home.appointments": "appointments",
  "home.actionItems": "Action Items",
  "home.viewAll": "View all",
  "home.recordNote": "Record Note",
  "home.scheduleVisit": "Schedule Visit",
  "home.scanDoc": "Scan Doc",
  "home.askPlaceholder": "Ask WellSaid anything...",
  "home.thinking": "Thinking",
  "home.prompt1": "Summarize my overall health.",
  "home.prompt2": "What action items do I have?",
  "home.prompt3": "What are my upcoming appointments?",
  "home.prompt4": "Summarize my recent documents.",

  "health.title": "Health",
  "health.appointments": "Appointments",
  "health.notes": "Notes",
  "health.sessions": "Sessions",
  "health.actions": "Actions",
  "health.noAppointments": "No appointments yet",
  "health.noNotes": "No notes yet",
  "health.noSessions": "No sessions yet",
  "health.noActions": "No action items yet",
  "health.action": "action",
  "health.actions_plural": "actions",
  "health.upcoming": "Upcoming",
  "health.completed": "Completed",
  "health.cancelled": "Cancelled",

  "translate.title": "Translate",
  "translate.sourceLanguage": "Source language",
  "translate.targetLanguage": "Target language",
  "translate.detected": "Detected: {lang}",
  "translate.placeholder": "Enter text to translate...",
  "translate.resultPlaceholder": "Translation will appear here",
  "translate.translating": "Translating...",
  "translate.button": "Translate",
  "translate.failed": "Translation failed. Please try again.",

  "documents.title": "Documents",
  "documents.noDocuments": "No documents yet",
  "documents.emptySubtext": "Use the camera or gallery to scan a medical document",
  "documents.scanPrompt": "Tap + to scan a document",
  "documents.scanning": "Scanning...",
  "documents.processing": "Processing document...",
  "documents.scanFailed": "Failed to process document. Please try again.",
  "documents.camera": "Camera",
  "documents.gallery": "Gallery",
  "documents.scanCamera": "Scan with camera",
  "documents.uploadGallery": "Upload from gallery",
  "documents.permissionTitle": "Permission needed",
  "documents.cameraPermission": "Camera access is required to scan documents.",
  "documents.galleryPermission": "Photo library access is required to upload documents.",

  "settings.title": "Settings",
  "settings.language": "Language",
  "settings.hospitalPhone": "Hospital Phone",
  "settings.signOutConfirm": "Are you sure you want to sign out?",
  "settings.saveFailed": "Failed to save settings.",
  "settings.highLegibility": "High Legibility Mode",
  "settings.highLegibilityDesc": "Larger text, higher contrast, and wider spacing for easier reading",
  "settings.emergencyMode": "Emergency Mode",
  "settings.emergencyModeDesc": "Quick-access recording with Care Circle alerts",
  "settings.careCirclePhone": "Care Circle Phone Number",
  "settings.careCirclePhonePlaceholder": "Emergency contact number",

  "onboarding.nameTitle": "What's your name?",
  "onboarding.firstName": "First name",
  "onboarding.lastName": "Last name",
  "onboarding.langTitle": "Preferred language",
  "onboarding.langSubtitle": "We'll use this across the app",
  "onboarding.phoneTitle": "Hospital phone",
  "onboarding.phoneSubtitle": "For scheduling appointments",
  "onboarding.genderTitle": "How would you like to be addressed?",
  "onboarding.genderSubtitle": "This helps us use respectful language.",
  "onboarding.genderIdentity": "Gender identity",
  "onboarding.pronouns": "Preferred pronouns",
  "onboarding.genderPlaceholder": "e.g. Woman, Man, Non-binary",
  "onboarding.pronounsPlaceholder": "e.g. she/her, he/him, they/them",

  "record.title": "Record Session",
  "record.ready": "Describe your visit or tap the mic to record",
  "record.recording": "Recording... tap to stop",
  "record.transcribing": "Transcribing...",
  "record.processing": "Processing your session...",
  "record.placeholder": "Describe what happened during your visit...",
  "record.submit": "Submit",
  "record.failed": "Failed to process session.",

  "recordNote.title": "Record Health Note",
  "recordNote.subtitle": "Record health incidents you're experiencing",
  "recordNote.placeholder": "Describe your symptoms or health concern...",

  "schedule.title": "Schedule Appointment",
  "schedule.reason": "Reason for visit",
  "schedule.reasonPlaceholder": "e.g. Annual checkup, headache follow-up",
  "schedule.doctor": "Doctor's name (optional)",
  "schedule.doctorPlaceholder": "e.g. Dr. Smith",
  "schedule.date": "Date",
  "schedule.time": "Time",
  "schedule.location": "Location (optional)",
  "schedule.locationPlaceholder": "e.g. City Hospital",
  "schedule.notes": "Notes (optional)",
  "schedule.notesPlaceholder": "Any additional details",
  "schedule.submit": "Schedule Appointment",
  "schedule.failed": "Failed to schedule appointment.",

  "emergency.title": "Emergency Mode",
  "emergency.recording": "Recording...",
  "emergency.alertSent": "Alert sent to Care Circle",
  "emergency.tapToStart": "Tap to start emergency recording",
  "emergency.alertFailed": "Failed to send alert. Recording saved.",
  "emergency.notConfigured": "Please set a Care Circle phone number in Settings first.",
};

const de: Dict = {
  "nav.home": "Start",
  "nav.health": "Gesundheit",
  "nav.documents": "Dokumente",
  "nav.translate": "Übersetzen",
  "nav.record": "Aufnahme",

  "common.save": "Speichern",
  "common.saved": "Gespeichert",
  "common.cancel": "Abbrechen",
  "common.back": "Zurück",
  "common.next": "Weiter",
  "common.loading": "Laden...",
  "common.saving": "Speichern...",
  "common.processing": "Verarbeitung...",
  "common.signOut": "Abmelden",
  "common.error": "Fehler",
  "common.getStarted": "Loslegen",
  "common.newChat": "Neuer Chat",
  "common.you": "Sie",

  "home.greeting.morning": "Guten Morgen",
  "home.greeting.afternoon": "Guten Tag",
  "home.greeting.evening": "Guten Abend",
  "home.subtitle": "Ihr Gesundheitsassistent hilft Ihnen gerne",
  "home.upcoming": "bevorstehend",
  "home.appointment": "Termin",
  "home.appointments": "Termine",
  "home.actionItems": "Aufgaben",
  "home.viewAll": "Alle anzeigen",
  "home.recordNote": "Notiz aufnehmen",
  "home.scheduleVisit": "Termin planen",
  "home.scanDoc": "Dokument scannen",
  "home.askPlaceholder": "Fragen Sie WellSaid...",
  "home.thinking": "Denkt nach",
  "home.prompt1": "Fassen Sie meine Gesundheit zusammen.",
  "home.prompt2": "Welche Aufgaben habe ich?",
  "home.prompt3": "Welche Termine stehen an?",
  "home.prompt4": "Fassen Sie meine letzten Dokumente zusammen.",

  "health.title": "Gesundheit",
  "health.appointments": "Termine",
  "health.notes": "Notizen",
  "health.sessions": "Sitzungen",
  "health.actions": "Aufgaben",
  "health.noAppointments": "Noch keine Termine",
  "health.noNotes": "Noch keine Notizen",
  "health.noSessions": "Noch keine Sitzungen",
  "health.noActions": "Noch keine Aufgaben",
  "health.action": "Aufgabe",
  "health.actions_plural": "Aufgaben",
  "health.upcoming": "Bevorstehend",
  "health.completed": "Abgeschlossen",
  "health.cancelled": "Storniert",

  "translate.title": "Übersetzen",
  "translate.sourceLanguage": "Ausgangssprache",
  "translate.targetLanguage": "Zielsprache",
  "translate.detected": "Erkannt: {lang}",
  "translate.placeholder": "Text zum Übersetzen eingeben...",
  "translate.resultPlaceholder": "Übersetzung erscheint hier",
  "translate.translating": "Übersetze...",
  "translate.button": "Übersetzen",
  "translate.failed": "Übersetzung fehlgeschlagen. Bitte erneut versuchen.",

  "documents.title": "Dokumente",
  "documents.noDocuments": "Noch keine Dokumente",
  "documents.emptySubtext": "Kamera oder Galerie nutzen, um ein medizinisches Dokument zu scannen",
  "documents.scanPrompt": "Tippen Sie +, um ein Dokument zu scannen",
  "documents.scanning": "Scannen...",
  "documents.processing": "Dokument wird verarbeitet...",
  "documents.scanFailed": "Dokument konnte nicht verarbeitet werden. Bitte erneut versuchen.",
  "documents.camera": "Kamera",
  "documents.gallery": "Galerie",
  "documents.scanCamera": "Mit Kamera scannen",
  "documents.uploadGallery": "Aus Galerie hochladen",
  "documents.permissionTitle": "Berechtigung erforderlich",
  "documents.cameraPermission": "Kamerazugriff ist zum Scannen von Dokumenten erforderlich.",
  "documents.galleryPermission": "Fotobibliothekszugriff ist zum Hochladen von Dokumenten erforderlich.",

  "settings.title": "Einstellungen",
  "settings.language": "Sprache",
  "settings.hospitalPhone": "Krankenhaustelefon",
  "settings.signOutConfirm": "Möchten Sie sich wirklich abmelden?",
  "settings.saveFailed": "Einstellungen konnten nicht gespeichert werden.",
  "settings.highLegibility": "Hohe Lesbarkeit",
  "settings.highLegibilityDesc": "Größere Schrift, höherer Kontrast und breiterer Abstand",
  "settings.emergencyMode": "Notfallmodus",
  "settings.emergencyModeDesc": "Schnellaufnahme mit Benachrichtigung an den Pflegekreis",
  "settings.careCirclePhone": "Pflegekreis-Telefonnummer",
  "settings.careCirclePhonePlaceholder": "Notfallkontaktnummer",

  "onboarding.nameTitle": "Wie heißen Sie?",
  "onboarding.firstName": "Vorname",
  "onboarding.lastName": "Nachname",
  "onboarding.langTitle": "Bevorzugte Sprache",
  "onboarding.langSubtitle": "Wird in der gesamten App verwendet",
  "onboarding.phoneTitle": "Krankenhaustelefon",
  "onboarding.phoneSubtitle": "Für die Terminplanung",
  "onboarding.genderTitle": "Wie möchten Sie angesprochen werden?",
  "onboarding.genderSubtitle": "Dies hilft uns, respektvoll zu kommunizieren.",
  "onboarding.genderIdentity": "Geschlechtsidentität",
  "onboarding.pronouns": "Bevorzugte Pronomen",
  "onboarding.genderPlaceholder": "z.B. Frau, Mann, Nicht-binär",
  "onboarding.pronounsPlaceholder": "z.B. sie/ihr, er/ihm, they/them",

  "record.title": "Sitzung aufnehmen",
  "record.ready": "Beschreiben Sie Ihren Besuch oder tippen Sie auf das Mikrofon",
  "record.recording": "Aufnahme... tippen zum Stoppen",
  "record.transcribing": "Transkribiere...",
  "record.processing": "Verarbeite Ihre Sitzung...",
  "record.placeholder": "Beschreiben Sie, was beim Besuch passiert ist...",
  "record.submit": "Absenden",
  "record.failed": "Sitzung konnte nicht verarbeitet werden.",

  "recordNote.title": "Gesundheitsnotiz aufnehmen",
  "recordNote.subtitle": "Gesundheitsvorfälle aufzeichnen",
  "recordNote.placeholder": "Beschreiben Sie Ihre Symptome...",

  "schedule.title": "Termin planen",
  "schedule.reason": "Grund des Besuchs",
  "schedule.reasonPlaceholder": "z.B. Jahresuntersuchung",
  "schedule.doctor": "Name des Arztes (optional)",
  "schedule.doctorPlaceholder": "z.B. Dr. Müller",
  "schedule.date": "Datum",
  "schedule.time": "Uhrzeit",
  "schedule.location": "Ort (optional)",
  "schedule.locationPlaceholder": "z.B. Stadtkrankenhaus",
  "schedule.notes": "Notizen (optional)",
  "schedule.notesPlaceholder": "Zusätzliche Details",
  "schedule.submit": "Termin planen",
  "schedule.failed": "Termin konnte nicht geplant werden.",

  "emergency.title": "Notfallmodus",
  "emergency.recording": "Aufnahme...",
  "emergency.alertSent": "Benachrichtigung an Pflegekreis gesendet",
  "emergency.tapToStart": "Tippen für Notfallaufnahme",
  "emergency.alertFailed": "Benachrichtigung fehlgeschlagen. Aufnahme gespeichert.",
  "emergency.notConfigured": "Bitte zuerst eine Pflegekreis-Telefonnummer in den Einstellungen festlegen.",
};

const nl: Dict = {
  "nav.home": "Start",
  "nav.health": "Gezondheid",
  "nav.documents": "Documenten",
  "nav.translate": "Vertalen",
  "nav.record": "Opname",

  "common.save": "Opslaan",
  "common.saved": "Opgeslagen",
  "common.cancel": "Annuleren",
  "common.back": "Terug",
  "common.next": "Volgende",
  "common.loading": "Laden...",
  "common.saving": "Opslaan...",
  "common.processing": "Verwerken...",
  "common.signOut": "Uitloggen",
  "common.error": "Fout",
  "common.getStarted": "Aan de slag",
  "common.newChat": "Nieuw gesprek",
  "common.you": "U",

  "home.greeting.morning": "Goedemorgen",
  "home.greeting.afternoon": "Goedemiddag",
  "home.greeting.evening": "Goedenavond",
  "home.subtitle": "Uw gezondheidsassistent helpt u graag",
  "home.upcoming": "aanstaand",
  "home.appointment": "afspraak",
  "home.appointments": "afspraken",
  "home.actionItems": "Actiepunten",
  "home.viewAll": "Alles bekijken",
  "home.recordNote": "Notitie opnemen",
  "home.scheduleVisit": "Afspraak plannen",
  "home.scanDoc": "Document scannen",
  "home.askPlaceholder": "Vraag WellSaid iets...",
  "home.thinking": "Denkt na",
  "home.prompt1": "Vat mijn gezondheid samen.",
  "home.prompt2": "Welke actiepunten heb ik?",
  "home.prompt3": "Welke afspraken staan er aan?",
  "home.prompt4": "Vat mijn recente documenten samen.",

  "health.title": "Gezondheid",
  "health.appointments": "Afspraken",
  "health.notes": "Notities",
  "health.sessions": "Sessies",
  "health.actions": "Acties",
  "health.noAppointments": "Nog geen afspraken",
  "health.noNotes": "Nog geen notities",
  "health.noSessions": "Nog geen sessies",
  "health.noActions": "Nog geen actiepunten",
  "health.action": "actie",
  "health.actions_plural": "acties",
  "health.upcoming": "Aanstaand",
  "health.completed": "Voltooid",
  "health.cancelled": "Geannuleerd",

  "translate.title": "Vertalen",
  "translate.sourceLanguage": "Brontaal",
  "translate.targetLanguage": "Doeltaal",
  "translate.detected": "Gedetecteerd: {lang}",
  "translate.placeholder": "Voer tekst in om te vertalen...",
  "translate.resultPlaceholder": "Vertaling verschijnt hier",
  "translate.translating": "Vertalen...",
  "translate.button": "Vertalen",
  "translate.failed": "Vertaling mislukt. Probeer het opnieuw.",

  "documents.title": "Documenten",
  "documents.noDocuments": "Nog geen documenten",
  "documents.emptySubtext": "Gebruik de camera of galerij om een medisch document te scannen",
  "documents.scanPrompt": "Tik op + om een document te scannen",
  "documents.scanning": "Scannen...",
  "documents.processing": "Document verwerken...",
  "documents.scanFailed": "Document verwerken mislukt. Probeer het opnieuw.",
  "documents.camera": "Camera",
  "documents.gallery": "Galerij",
  "documents.scanCamera": "Scannen met camera",
  "documents.uploadGallery": "Uploaden uit galerij",
  "documents.permissionTitle": "Toestemming vereist",
  "documents.cameraPermission": "Cameratoegang is vereist om documenten te scannen.",
  "documents.galleryPermission": "Fotobibliotheektoegang is vereist om documenten te uploaden.",

  "settings.title": "Instellingen",
  "settings.language": "Taal",
  "settings.hospitalPhone": "Ziekenhuistelefoon",
  "settings.signOutConfirm": "Weet u zeker dat u wilt uitloggen?",
  "settings.saveFailed": "Instellingen konden niet worden opgeslagen.",
  "settings.highLegibility": "Hoge leesbaarheid",
  "settings.highLegibilityDesc": "Grotere tekst, hoger contrast en bredere spatiëring",
  "settings.emergencyMode": "Noodmodus",
  "settings.emergencyModeDesc": "Snelle opname met waarschuwing aan zorgkring",
  "settings.careCirclePhone": "Zorgkring telefoonnummer",
  "settings.careCirclePhonePlaceholder": "Noodcontactnummer",

  "onboarding.nameTitle": "Wat is uw naam?",
  "onboarding.firstName": "Voornaam",
  "onboarding.lastName": "Achternaam",
  "onboarding.langTitle": "Voorkeurstaal",
  "onboarding.langSubtitle": "Wordt in de hele app gebruikt",
  "onboarding.phoneTitle": "Ziekenhuistelefoon",
  "onboarding.phoneSubtitle": "Voor het plannen van afspraken",
  "onboarding.genderTitle": "Hoe wilt u aangesproken worden?",
  "onboarding.genderSubtitle": "Dit helpt ons respectvol te communiceren.",
  "onboarding.genderIdentity": "Genderidentiteit",
  "onboarding.pronouns": "Voorkeurvoornaamwoorden",
  "onboarding.genderPlaceholder": "bijv. Vrouw, Man, Non-binair",
  "onboarding.pronounsPlaceholder": "bijv. zij/haar, hij/hem, hen/hun",

  "record.title": "Sessie opnemen",
  "record.ready": "Beschrijf uw bezoek of tik op de microfoon",
  "record.recording": "Opname... tik om te stoppen",
  "record.transcribing": "Transcriberen...",
  "record.processing": "Uw sessie verwerken...",
  "record.placeholder": "Beschrijf wat er tijdens het bezoek is gebeurd...",
  "record.submit": "Indienen",
  "record.failed": "Sessie kon niet worden verwerkt.",

  "recordNote.title": "Gezondheidsnotitie opnemen",
  "recordNote.subtitle": "Gezondheidsproblemen vastleggen",
  "recordNote.placeholder": "Beschrijf uw symptomen...",

  "schedule.title": "Afspraak plannen",
  "schedule.reason": "Reden van bezoek",
  "schedule.reasonPlaceholder": "bijv. Jaarlijkse controle",
  "schedule.doctor": "Naam arts (optioneel)",
  "schedule.doctorPlaceholder": "bijv. Dr. de Vries",
  "schedule.date": "Datum",
  "schedule.time": "Tijd",
  "schedule.location": "Locatie (optioneel)",
  "schedule.locationPlaceholder": "bijv. Stadsziekenhuis",
  "schedule.notes": "Notities (optioneel)",
  "schedule.notesPlaceholder": "Aanvullende details",
  "schedule.submit": "Afspraak plannen",
  "schedule.failed": "Afspraak kon niet worden gepland.",

  "emergency.title": "Noodmodus",
  "emergency.recording": "Opname...",
  "emergency.alertSent": "Waarschuwing verzonden naar zorgkring",
  "emergency.tapToStart": "Tik voor noodopname",
  "emergency.alertFailed": "Waarschuwing mislukt. Opname opgeslagen.",
  "emergency.notConfigured": "Stel eerst een zorgkring-telefoonnummer in bij Instellingen.",
};

const es: Dict = {
  "nav.home": "Inicio",
  "nav.health": "Salud",
  "nav.documents": "Documentos",
  "nav.translate": "Traducir",
  "nav.record": "Grabar",
  "common.save": "Guardar",
  "common.saved": "Guardado",
  "common.cancel": "Cancelar",
  "common.back": "Atrás",
  "common.next": "Siguiente",
  "common.loading": "Cargando...",
  "common.saving": "Guardando...",
  "common.processing": "Procesando...",
  "common.signOut": "Cerrar sesión",
  "common.error": "Error",
  "common.getStarted": "Empezar",
  "common.newChat": "Nuevo chat",
  "common.you": "Tú",
  "home.greeting.morning": "Buenos días",
  "home.greeting.afternoon": "Buenas tardes",
  "home.greeting.evening": "Buenas noches",
  "home.subtitle": "Su asistente de salud está aquí para ayudarle",
  "home.upcoming": "próxima",
  "home.appointment": "cita",
  "home.appointments": "citas",
  "home.actionItems": "Tareas pendientes",
  "home.viewAll": "Ver todo",
  "home.recordNote": "Anotar",
  "home.scheduleVisit": "Agendar cita",
  "home.scanDoc": "Escanear",
  "home.askPlaceholder": "Pregunta a WellSaid...",
  "home.thinking": "Pensando",
  "home.prompt1": "Resume mi salud general.",
  "home.prompt2": "¿Qué tareas tengo?",
  "home.prompt3": "¿Cuáles son mis próximas citas?",
  "home.prompt4": "Resume mis documentos recientes.",
  "health.title": "Salud",
  "health.appointments": "Citas",
  "health.notes": "Notas",
  "health.sessions": "Sesiones",
  "health.actions": "Tareas",
  "health.noAppointments": "Sin citas aún",
  "health.noNotes": "Sin notas aún",
  "health.noSessions": "Sin sesiones aún",
  "health.noActions": "Sin tareas aún",
  "health.action": "tarea",
  "health.actions_plural": "tareas",
  "health.upcoming": "Próximas",
  "health.completed": "Completadas",
  "health.cancelled": "Canceladas",
  "translate.title": "Traducir",
  "translate.sourceLanguage": "Idioma origen",
  "translate.targetLanguage": "Idioma destino",
  "translate.detected": "Detectado: {lang}",
  "translate.placeholder": "Ingrese texto para traducir...",
  "translate.resultPlaceholder": "La traducción aparecerá aquí",
  "translate.translating": "Traduciendo...",
  "translate.button": "Traducir",
  "translate.failed": "Traducción fallida. Intente de nuevo.",
  "documents.title": "Documentos",
  "documents.noDocuments": "Sin documentos aún",
  "documents.emptySubtext": "Use la cámara o la galería para escanear un documento médico",
  "documents.scanPrompt": "Toque + para escanear un documento",
  "documents.scanning": "Escaneando...",
  "documents.processing": "Procesando documento...",
  "documents.scanFailed": "Error al procesar documento. Intente de nuevo.",
  "documents.camera": "Cámara",
  "documents.gallery": "Galería",
  "documents.scanCamera": "Escanear con cámara",
  "documents.uploadGallery": "Subir desde galería",
  "documents.permissionTitle": "Permiso necesario",
  "documents.cameraPermission": "Se requiere acceso a la cámara para escanear documentos.",
  "documents.galleryPermission": "Se requiere acceso a la galería para subir documentos.",
  "settings.title": "Ajustes",
  "settings.language": "Idioma",
  "settings.hospitalPhone": "Teléfono del hospital",
  "settings.signOutConfirm": "¿Está seguro de que desea cerrar sesión?",
  "settings.saveFailed": "Error al guardar ajustes.",
  "settings.highLegibility": "Alta legibilidad",
  "settings.highLegibilityDesc": "Texto más grande, mayor contraste y espaciado amplio",
  "settings.emergencyMode": "Modo emergencia",
  "settings.emergencyModeDesc": "Grabación rápida con alerta al círculo de cuidado",
  "settings.careCirclePhone": "Teléfono del círculo de cuidado",
  "settings.careCirclePhonePlaceholder": "Número de contacto de emergencia",
  "onboarding.nameTitle": "¿Cómo se llama?",
  "onboarding.firstName": "Nombre",
  "onboarding.lastName": "Apellido",
  "onboarding.langTitle": "Idioma preferido",
  "onboarding.langSubtitle": "Lo usaremos en toda la aplicación",
  "onboarding.phoneTitle": "Teléfono del hospital",
  "onboarding.phoneSubtitle": "Para programar citas",
  "onboarding.genderTitle": "¿Cómo le gustaría que se dirijan a usted?",
  "onboarding.genderSubtitle": "Nos ayuda a usar un lenguaje respetuoso.",
  "onboarding.genderIdentity": "Identidad de género",
  "onboarding.pronouns": "Pronombres preferidos",
  "onboarding.genderPlaceholder": "ej. Mujer, Hombre, No binario",
  "onboarding.pronounsPlaceholder": "ej. ella, él, elle",
  "record.title": "Grabar sesión",
  "record.ready": "Describa su visita o toque el micrófono",
  "record.recording": "Grabando... toque para detener",
  "record.transcribing": "Transcribiendo...",
  "record.processing": "Procesando su sesión...",
  "record.placeholder": "Describa lo que pasó durante su visita...",
  "record.submit": "Enviar",
  "record.failed": "Error al procesar la sesión.",
  "recordNote.title": "Grabar nota de salud",
  "recordNote.subtitle": "Registre incidentes de salud",
  "recordNote.placeholder": "Describa sus síntomas...",
  "schedule.title": "Programar cita",
  "schedule.reason": "Motivo de la visita",
  "schedule.reasonPlaceholder": "ej. Chequeo anual",
  "schedule.doctor": "Nombre del doctor (opcional)",
  "schedule.doctorPlaceholder": "ej. Dr. García",
  "schedule.date": "Fecha",
  "schedule.time": "Hora",
  "schedule.location": "Ubicación (opcional)",
  "schedule.locationPlaceholder": "ej. Hospital Central",
  "schedule.notes": "Notas (opcional)",
  "schedule.notesPlaceholder": "Detalles adicionales",
  "schedule.submit": "Programar cita",
  "schedule.failed": "Error al programar la cita.",
  "emergency.title": "Modo emergencia",
  "emergency.recording": "Grabando...",
  "emergency.alertSent": "Alerta enviada al círculo de cuidado",
  "emergency.tapToStart": "Toque para grabación de emergencia",
  "emergency.alertFailed": "Error al enviar alerta. Grabación guardada.",
  "emergency.notConfigured": "Configure un número de contacto de emergencia en Ajustes primero.",
};

const fr: Dict = {
  "nav.home": "Accueil",
  "nav.health": "Santé",
  "nav.documents": "Documents",
  "nav.translate": "Traduire",
  "nav.record": "Enregistrer",
  "common.save": "Enregistrer",
  "common.saved": "Enregistré",
  "common.cancel": "Annuler",
  "common.back": "Retour",
  "common.next": "Suivant",
  "common.loading": "Chargement...",
  "common.saving": "Enregistrement...",
  "common.processing": "Traitement...",
  "common.signOut": "Déconnexion",
  "common.error": "Erreur",
  "common.getStarted": "Commencer",
  "common.newChat": "Nouveau chat",
  "common.you": "Vous",
  "home.greeting.morning": "Bonjour",
  "home.greeting.afternoon": "Bon après-midi",
  "home.greeting.evening": "Bonsoir",
  "home.subtitle": "Votre assistant santé est là pour vous aider",
  "home.upcoming": "à venir",
  "home.appointment": "rendez-vous",
  "home.appointments": "rendez-vous",
  "home.actionItems": "Tâches",
  "home.viewAll": "Tout voir",
  "home.recordNote": "Prendre note",
  "home.scheduleVisit": "Planifier visite",
  "home.scanDoc": "Scanner",
  "home.askPlaceholder": "Demandez à WellSaid...",
  "home.thinking": "Réflexion",
  "home.prompt1": "Résumez ma santé globale.",
  "home.prompt2": "Quelles sont mes tâches?",
  "home.prompt3": "Quels sont mes prochains rendez-vous?",
  "home.prompt4": "Résumez mes documents récents.",
  "health.title": "Santé",
  "health.appointments": "Rendez-vous",
  "health.notes": "Notes",
  "health.sessions": "Sessions",
  "health.actions": "Tâches",
  "health.noAppointments": "Pas encore de rendez-vous",
  "health.noNotes": "Pas encore de notes",
  "health.noSessions": "Pas encore de sessions",
  "health.noActions": "Pas encore de tâches",
  "health.action": "tâche",
  "health.actions_plural": "tâches",
  "health.upcoming": "À venir",
  "health.completed": "Terminé",
  "health.cancelled": "Annulé",
  "translate.title": "Traduire",
  "translate.sourceLanguage": "Langue source",
  "translate.targetLanguage": "Langue cible",
  "translate.detected": "Détecté: {lang}",
  "translate.placeholder": "Entrez le texte à traduire...",
  "translate.resultPlaceholder": "La traduction apparaîtra ici",
  "translate.translating": "Traduction...",
  "translate.button": "Traduire",
  "translate.failed": "Traduction échouée. Réessayez.",
  "documents.title": "Documents",
  "documents.noDocuments": "Pas encore de documents",
  "documents.emptySubtext": "Utilisez l'appareil photo ou la galerie pour scanner un document médical",
  "documents.scanPrompt": "Appuyez sur + pour scanner un document",
  "documents.scanning": "Numérisation...",
  "documents.processing": "Traitement du document...",
  "documents.scanFailed": "Échec du traitement du document. Veuillez réessayer.",
  "documents.camera": "Appareil photo",
  "documents.gallery": "Galerie",
  "documents.scanCamera": "Scanner avec l'appareil photo",
  "documents.uploadGallery": "Télécharger depuis la galerie",
  "documents.permissionTitle": "Autorisation requise",
  "documents.cameraPermission": "L'accès à l'appareil photo est requis pour scanner des documents.",
  "documents.galleryPermission": "L'accès à la photothèque est requis pour télécharger des documents.",
  "settings.title": "Paramètres",
  "settings.language": "Langue",
  "settings.hospitalPhone": "Téléphone de l'hôpital",
  "settings.signOutConfirm": "Voulez-vous vraiment vous déconnecter?",
  "settings.saveFailed": "Échec de l'enregistrement.",
  "settings.highLegibility": "Haute lisibilité",
  "settings.highLegibilityDesc": "Texte plus grand, contraste élevé et espacement large",
  "settings.emergencyMode": "Mode urgence",
  "settings.emergencyModeDesc": "Enregistrement rapide avec alerte au cercle de soins",
  "settings.careCirclePhone": "Téléphone du cercle de soins",
  "settings.careCirclePhonePlaceholder": "Numéro de contact d'urgence",
  "onboarding.nameTitle": "Comment vous appelez-vous?",
  "onboarding.firstName": "Prénom",
  "onboarding.lastName": "Nom",
  "onboarding.langTitle": "Langue préférée",
  "onboarding.langSubtitle": "Utilisée dans toute l'application",
  "onboarding.phoneTitle": "Téléphone de l'hôpital",
  "onboarding.phoneSubtitle": "Pour la prise de rendez-vous",
  "onboarding.genderTitle": "Comment souhaitez-vous être adressé(e)?",
  "onboarding.genderSubtitle": "Cela nous aide à utiliser un langage respectueux.",
  "onboarding.genderIdentity": "Identité de genre",
  "onboarding.pronouns": "Pronoms préférés",
  "onboarding.genderPlaceholder": "ex. Femme, Homme, Non-binaire",
  "onboarding.pronounsPlaceholder": "ex. elle, il, iel",
  "record.title": "Enregistrer session",
  "record.ready": "Décrivez votre visite ou appuyez sur le micro",
  "record.recording": "Enregistrement... appuyez pour arrêter",
  "record.transcribing": "Transcription...",
  "record.processing": "Traitement de votre session...",
  "record.placeholder": "Décrivez ce qui s'est passé durant la visite...",
  "record.submit": "Soumettre",
  "record.failed": "Échec du traitement de la session.",
  "recordNote.title": "Enregistrer une note de santé",
  "recordNote.subtitle": "Enregistrez vos incidents de santé",
  "recordNote.placeholder": "Décrivez vos symptômes...",
  "schedule.title": "Planifier rendez-vous",
  "schedule.reason": "Motif de la visite",
  "schedule.reasonPlaceholder": "ex. Bilan annuel",
  "schedule.doctor": "Nom du médecin (optionnel)",
  "schedule.doctorPlaceholder": "ex. Dr. Dupont",
  "schedule.date": "Date",
  "schedule.time": "Heure",
  "schedule.location": "Lieu (optionnel)",
  "schedule.locationPlaceholder": "ex. Hôpital central",
  "schedule.notes": "Notes (optionnel)",
  "schedule.notesPlaceholder": "Détails supplémentaires",
  "schedule.submit": "Planifier rendez-vous",
  "schedule.failed": "Échec de la planification.",
  "emergency.title": "Mode urgence",
  "emergency.recording": "Enregistrement...",
  "emergency.alertSent": "Alerte envoyée au cercle de soins",
  "emergency.tapToStart": "Appuyez pour enregistrement d'urgence",
  "emergency.alertFailed": "Échec de l'alerte. Enregistrement sauvegardé.",
  "emergency.notConfigured": "Configurez d'abord un numéro de cercle de soins dans les Paramètres.",
};

const sq: Dict = {
  "nav.home": "Kryefaqja",
  "nav.health": "Shëndeti",
  "nav.documents": "Dokumentet",
  "nav.translate": "Përkthe",
  "nav.record": "Regjistro",
  "common.save": "Ruaj",
  "common.saved": "Ruajtur",
  "common.cancel": "Anulo",
  "common.back": "Kthehu",
  "common.next": "Vazhdo",
  "common.loading": "Duke ngarkuar...",
  "common.saving": "Duke ruajtur...",
  "common.processing": "Duke përpunuar...",
  "common.signOut": "Dil",
  "common.error": "Gabim",
  "common.getStarted": "Fillo",
  "common.newChat": "Bisedë e re",
  "common.you": "Ju",
  "home.greeting.morning": "Mirëmëngjes",
  "home.greeting.afternoon": "Mirëdita",
  "home.greeting.evening": "Mirëmbrëmje",
  "home.subtitle": "Asistenti juaj shëndetësor është këtu për t'ju ndihmuar",
  "home.upcoming": "të ardhshme",
  "home.appointment": "takim",
  "home.appointments": "takime",
  "home.actionItems": "Detyrat",
  "home.viewAll": "Shiko të gjitha",
  "home.recordNote": "Shënim",
  "home.scheduleVisit": "Cakto vizitë",
  "home.scanDoc": "Skano",
  "home.askPlaceholder": "Pyetni WellSaid...",
  "home.thinking": "Duke menduar",
  "home.prompt1": "Përmbledh shëndetin tim.",
  "home.prompt2": "Cilat janë detyrat e mia?",
  "home.prompt3": "Cilat janë takimet e ardhshme?",
  "home.prompt4": "Përmbledh dokumentet e fundit.",
  "health.title": "Shëndeti",
  "health.appointments": "Takimet",
  "health.notes": "Shënimet",
  "health.sessions": "Seancat",
  "health.actions": "Detyrat",
  "health.noAppointments": "Asnjë takim",
  "health.noNotes": "Asnjë shënim",
  "health.noSessions": "Asnjë seancë",
  "health.noActions": "Asnjë detyrë",
  "health.action": "detyrë",
  "health.actions_plural": "detyra",
  "health.upcoming": "Të ardhshme",
  "health.completed": "Përfunduar",
  "health.cancelled": "Anuluar",
  "translate.title": "Përkthe",
  "translate.sourceLanguage": "Gjuha burim",
  "translate.targetLanguage": "Gjuha cak",
  "translate.detected": "Zbuluar: {lang}",
  "translate.placeholder": "Shkruani tekstin për përkthim...",
  "translate.resultPlaceholder": "Përkthimi do të shfaqet këtu",
  "translate.translating": "Duke përkthyer...",
  "translate.button": "Përkthe",
  "translate.failed": "Përkthimi dështoi. Provoni përsëri.",
  "documents.title": "Dokumentet",
  "documents.noDocuments": "Asnjë dokument",
  "documents.emptySubtext": "Përdorni kamerën ose galerinë për të skanuar një dokument mjekësor",
  "documents.scanPrompt": "Shtypni + për të skanuar",
  "documents.scanning": "Duke skanuar...",
  "documents.processing": "Duke përpunuar dokumentin...",
  "documents.scanFailed": "Përpunimi i dokumentit dështoi. Provoni përsëri.",
  "documents.camera": "Kamera",
  "documents.gallery": "Galeri",
  "documents.scanCamera": "Skano me kamerë",
  "documents.uploadGallery": "Ngarko nga galeria",
  "documents.permissionTitle": "Leje e nevojshme",
  "documents.cameraPermission": "Qasja në kamerë kërkohet për të skanuar dokumente.",
  "documents.galleryPermission": "Qasja në bibliotekën e fotove kërkohet për të ngarkuar dokumente.",
  "settings.title": "Cilësimet",
  "settings.language": "Gjuha",
  "settings.hospitalPhone": "Telefoni i spitalit",
  "settings.signOutConfirm": "Jeni i sigurt që dëshironi të dilni?",
  "settings.saveFailed": "Ruajtja dështoi.",
  "settings.highLegibility": "Lexueshmëri e lartë",
  "settings.highLegibilityDesc": "Tekst më i madh, kontrast më i lartë",
  "settings.emergencyMode": "Mënyra e urgjencës",
  "settings.emergencyModeDesc": "Regjistrim i shpejtë me alarmim",
  "settings.careCirclePhone": "Nr. i kontaktit emergjent",
  "settings.careCirclePhonePlaceholder": "Numri i kontaktit",
  "onboarding.nameTitle": "Si quheni?",
  "onboarding.firstName": "Emri",
  "onboarding.lastName": "Mbiemri",
  "onboarding.langTitle": "Gjuha e preferuar",
  "onboarding.langSubtitle": "Përdoret në të gjithë aplikacionin",
  "onboarding.phoneTitle": "Telefoni i spitalit",
  "onboarding.phoneSubtitle": "Për caktimin e takimeve",
  "onboarding.genderTitle": "Si dëshironi t'ju drejtohemi?",
  "onboarding.genderSubtitle": "Na ndihmon të përdorim gjuhë të përshtatshme.",
  "onboarding.genderIdentity": "Identiteti gjinor",
  "onboarding.pronouns": "Përemrat e preferuar",
  "onboarding.genderPlaceholder": "p.sh. Grua, Burrë, Jo-binar",
  "onboarding.pronounsPlaceholder": "p.sh. ajo/asaj, ai/atij",
  "record.title": "Regjistro seancë",
  "record.ready": "Përshkruani vizitën ose shtypni mikrofonin",
  "record.recording": "Duke regjistruar...",
  "record.transcribing": "Duke transkriptuar...",
  "record.processing": "Duke përpunuar seancën...",
  "record.placeholder": "Përshkruani çfarë ndodhi...",
  "record.submit": "Dërgo",
  "record.failed": "Përpunimi dështoi.",
  "recordNote.title": "Regjistro shënim shëndetësor",
  "recordNote.subtitle": "Regjistroni problemet shëndetësore",
  "recordNote.placeholder": "Përshkruani simptomat...",
  "schedule.title": "Cakto takim",
  "schedule.reason": "Arsyeja",
  "schedule.reasonPlaceholder": "p.sh. Kontroll vjetor",
  "schedule.doctor": "Emri i mjekut (opsionale)",
  "schedule.doctorPlaceholder": "p.sh. Dr. Hoxha",
  "schedule.date": "Data",
  "schedule.time": "Ora",
  "schedule.location": "Vendi (opsionale)",
  "schedule.locationPlaceholder": "p.sh. Spitali i qytetit",
  "schedule.notes": "Shënime (opsionale)",
  "schedule.notesPlaceholder": "Detaje shtesë",
  "schedule.submit": "Cakto takimin",
  "schedule.failed": "Caktimi dështoi.",
  "emergency.title": "Mënyra e urgjencës",
  "emergency.recording": "Duke regjistruar...",
  "emergency.alertSent": "Alarmi u dërgua",
  "emergency.tapToStart": "Shtypni për regjistrim urgjent",
  "emergency.alertFailed": "Alarmi dështoi. Regjistrimi u ruajt.",
  "emergency.notConfigured": "Vendosni numrin e kontaktit në Cilësime.",
};

const translations: Record<string, Dict> = { en, de, nl, es, fr, sq };

const translate = (lang: string, key: string, vars?: Record<string, string>): string => {
  let text = translations[lang]?.[key] ?? translations.en[key] ?? key;
  if (vars) {
    for (const [k, v] of Object.entries(vars)) {
      text = text.replace(`{${k}}`, v);
    }
  }
  return text;
};

export const I18nProvider = ({ children }: { children: React.ReactNode }) => {
  const [lang, setLangState] = useState("en");

  useEffect(() => {
    const loadLang = async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return;
      const { data } = await supabase
        .from("profiles")
        .select("preferred_language")
        .eq("id", user.id)
        .single();
      if (data?.preferred_language) {
        setLangState(data.preferred_language);
      }
    };
    loadLang();
  }, []);

  const setLang = useCallback((code: string) => {
    setLangState(code);
  }, []);

  const t: TranslateFunction = useCallback(
    (key: string, vars?: Record<string, string>) => translate(lang, key, vars),
    [lang]
  );

  const value = useMemo(() => ({ lang, setLang, t }), [lang, setLang, t]);

  return (
    <I18nContext.Provider value={value}>
      {children}
    </I18nContext.Provider>
  );
};

export const useI18n = () => useContext(I18nContext);
